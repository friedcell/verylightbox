<!doctype html>
<html>
	<head>
		<title>Lightbox</title>
		<style>
			html, body {margin:0;padding:0;border:0;background:#ffc;font-family:sans-serif;}
			ul, li {margin:0;padding:0;border:0;display:block;}
			li {padding:5px 0 0 5px;float:left;}
			a img {border:0;}
			ul li a img {height:150px;}
			
			.LBwrapper {position:fixed;top:0;right:0;bottom:0;left:0;padding:20px;z-index:10000;background:rgba(0,0,0,.75);text-align:center;line-height:0;}
			.LBwrapper .LBcontent {display:inline;}
			.LBwrapper .LBcontent img {display:inline;border:10px solid #fff;max-width:100%;max-height:100%;vertical-align:-.25em;
				-webkit-box-sizing:border-box;-webkit-border-radius:2px;
				-moz-box-sizing:border-box;-moz-border-radius:2px;
				box-sizing:border-box;border-radius:2px;
			}
			
			.LBwrapper .LBcontent.withText {position:relative;}
			.LBwrapper .LBcontent.withText img {border-bottom-width:40px;}
			.LBwrapper .LBcontent.withText .LBabout {position:absolute;bottom:0;left:0;right:0;padding:10px 0;margin:0 10px;line-height:20px;text-align:left;height:20px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;}
			
			.LBwrapper .LBcontent.withDownload .LBabout {padding-right:5em;}
			.LBwrapper .LBcontent.withDownload .LBdownload {position:absolute;bottom:10px;right:10px;padding:.25em .5em;text-transform:uppercase;color:#222;font-size:.625em;line-height:1.5;background:#ccc;color:#222;text-decoration:none;font-weight:bold;cursor:pointer;
				-webkit-border-radius:2px;-webkit-box-shadow:0 0 1px #000;
				-moz-border-radius:2px;-moz-box-shadow:0 0 1px #000;
				border-radius:2px;box-shadow:0 0 1px #000;
			}
			
			.LBwrapper .LBclose {position:absolute;right:5px;top:5px;display:block;padding:.25em .5em;background:#fff;color:#222;text-decoration:none;text-transform:uppercase;font-weight:bold;font-size:.625em;line-height:1.5;cursor:pointer;
				-webkit-border-radius:2px;
				-moz-border-radius:2px;
				border-radius:2px;
			}
		</style>
	</head>
	<body>
		<ul>
			<li>
				<a class="lb" href="download1.jpg" data-big="bigger1.jpg">
					<img src="thumb1.jpg" title="Candice Swanepoel" alt="Top 99 Women" />
				</a>
			</li>
			<li>
				<a class="lb" href="download2.jpg" data-big="bigger2.jpg">
					<img src="thumb2.jpg" title="Candice Swanepoel" alt="Design your Trust" />
				</a>
			</li>
			<li>
				<a class="lb" href="download3.jpg" data-big="bigger3.jpg">
					<img src="thumb3.jpg" title="Candice Swanepoel" alt="38 Breath Taking Victoria's Secret Swim Photos" />
				</a>
			</li>
		</ul>
	</body>
	<script>
		/**
		 * ID provides an object that gives out unique ids to DOM elements and indexes them
		 **/
		/*var ID = function (root) {
			var idMap = {},
				seed = 0,
				supportsDataset = (function () {
					var el = document.createElement('div');
					return !!el.dataset;
				}()),
				gen = function () {
					return root + "-" + (++seed);
				},
				getData = function (el, prop, def) {
					return supportsDataset && el.dataset && el.dataset[prop] || def;
				},
				p = {
					'get': function (el, generate) {
						var r = el.id || getData(el, 'id'),
							k;
						// if element doesn't have an id attached, try to find it in the index
						if (!r && (!supportsDataset || !el.dataset)) {
							for (k in idMap) {
								if (idMap[k] === el) {
									r = k;
								}
							}
						}
						if (!r && generate) {
							r = gen();
							if (supportsDataset && el.dataset) {
								el.dataset.id = r;
							}
							idMap[r] = el;
						}
						return r;
					},
					'fetch': function (id) {
						return idMap[id];
					},
					'debug': function () {
						return [root, seed, supportsDataset, gen, idMap, p];
					}
				};
			return p;
		};*/
		/**
		 * Events provides an object that handles events
		 **/
		/*var Events = (function () {
			function typesplit(s) {
				var l = s.indexOf('.') > 0 ? s.split('.') : [s, ''];
				return {'type': l.shift(), 'ns': l.join('.')};
			}
			var idGen = ID('events'),
				handlers = {},
				p = {
					'on': function (el, type, handler, scope) {
						type = typesplit(type);
						var id = idGen.get(el, true),
							d = {
								id: idGen.get(el, true),
								el: el,
								type: type.type,
								ns: type.ns,
								handler: handler,
								proxy: function () {
									handler.apply(scope, arguments);
								},
								start: (new Date).getTime()
							};
						if (!handlers[id]) {
							handlers[id] = {};
						}
						if (!handlers[id][type.type]) {
							handlers[id][type.type] = [];
						}
						handlers[id][type.type].push(d);
						if (el.nodeType === 1) {
							el.addEventListener(type.type, d.proxy);
						}
						return p;
					},
					'off': function (el, type, handler) {
						var id = idGen.get(el),
							dtype = typesplit(type),
							h, i, j, n,
							r = [];
						if (!id) {
							return p;
						}
						h = handlers[id][dtype.type] || [];
						for (i = 0, j = h.length; i < j; i++) {
							n = h[i];
							if ((dtype.ns && n.ns === dtype.ns || !dtype.ns) && (handler && n.handler === handler || !handler)) {
								if (el.nodeType === 1) {
									el.removeEventListener(dtype.type, h[i].proxy);
								}
							} else {
								r.push(n);
							}
						}
						if (r.length) {
							handlers[id][dtype.type] = r;
						} else {
							delete handlers[id][dtype.type];
						}
					},
					'trigger': function (el, type, data) {
						if (el.nodeType === 1 && el.type) {
							el[type]();
							// how do you trigger custom event types? surely not manually?!
						} else {
							var id = idGen.get(el), 
								dtype = typesplit(type),
								h, i, j, n;
							if (!id) {
								return p;
							}
							h = handlers[id][dtype.type] || [];
							for (i = 0, j = h.length; i < j; i++) {
								n = h[i];
								n.proxy(data);
							}
						}
					},
					'gc': function () {
						// remove all nodes with no parent
						// no idea how to make sure we don't lean objects though....	
					},
					'debug': function () {
						return [idGen, handlers, p];
					}
				};
			return p;
		}());*/
		/**
		 * Simple events
		 **/
		var CustEv = (function () {
			function createEvent(type) {
				return (r = {
					'type': type,
					'stopPropagation': function () {
						r.stop = true;
					},
					'stop': false
				});
			}
			return function () {
				var store = {};
				return {
					'on': function (type, handler, data) {
						if (!store[type]) store[type] = [[handler, data]];
						else store[type].push([handler, data]);
					},
					'off': function (type, handler) {
						if (!handler) {
							return !!(store[type] = []);
						}
						var i = store[type] && store[type].length || -1;
						for (; i >= 0; i -= 1) {
							if (store[type][i][0] === handler) {
								store[type].splice(i, 1);
								return true;
							}
						}
						return false;
					},
					'fire': function (type, data) {
						var i = 0,
							l = store[type] && store[type].length || 0,
							ev = createEvent(type),
							d;
						for (; i < l; i += 1) {
							try {
								ev.data = store[type][i][1];
								store[type][i][0].apply(this, [ev].concat(data || []));
							} catch (e) {}
							if (ev.stop) {
								break;
							}
						}
					}
				};
			}
		}());
		/**
		 * LightBox object
		 **/
		var LightBox = (function () {
			var doc = document,
				LB = function (thumbs, conf) {
					var i;
					if (this === window) {
						i = new LB(thumbs, conf);
						LB.instances.push(i);
						return i;
					}
					this.conf = b.extend(b.extend({}, LB.defaults), conf);
					this.thumbs = thumbs;
					this.links = [];
					for (i = this.thumbs.length - 1; i >= 0; i -= 1) {
						this.links[i] = this.setupLink(i);
					}
					this.selectedIndex = -1;
					this.content = null;
					this.state = 0;
				},
				b = {
					'append': function (wr, el) {
						wr.appendChild(el);
						return el;
					},
					'detach': function (el) {
						el.parentNode && el.parentNode.removeChild(el);
						return el;
					},
					'on': function (el, type, handler, scope, addArgs) {
						handler.__handler__ = function () {
							var args = Array.prototype.slice.call(arguments);
							args = args.concat(addArgs || []);
							handler.apply(scope || this, args);
						};
						el.addEventListener(type, handler.__handler__, false);
						return el;
					},
					'off': function (el, type, handler) {
						el.removeEventListener(type, handler.__handler__)
						return el;
					},
					'hasClass': function (el, cls) {
						var c = ' ' + el.className + ' ';
						return c.indexOf(' ' + cls + ' ') >= 0;
					},
					'addClass': function (el, cls) {
						var c;
						if (!b.hasClass(el, cls)) {
							c = el.className + ' ' + cls;
							while (c.indexOf('  ') >= 0) {
								c = c.replace(/  /g, ' ');
							}
							el.className = c;
						}
					},
					'extend': function (a, b) {
						for (k in b) {
							a[k] = b[k];
						}
						return a;
					},
					'repaint': function (el) {
						var d = el.style.display;
						el.style.display = 'none';
						el.parentNode.offsetWidth;
						el.style.display = 'block';
					}
				},
				e = {
					'linkClick': function (ev, idx) {
						var link = ev.currentTarget || ev.srcElement;
						ev.preventDefault();
						if (idx !== this.selectedIndex) {
							this.selectedIndex = idx;
							this.setupContent();
						}
						this.open();
					},
					'openWrapperClick': function (ev) {
						var target = ev.target || ev.srcElement;
						if (b.hasClass(target, this.conf.wrapperClass)) {
							this.close();
						}
					},
					'imageLoad': function (ev) {
						var img = this.content.getElementsByTagName('img')[0];
						b.repaint(this.content);
					}
				}
			b.extend(LB, {
				"instances": [],
				"defaults": {
					wrapperClass: 'LBwrapper',
					contentClass: 'LBcontent'
				},
				"handlers": e,
				"helpers": b
			});
			
			b.extend(LB.prototype, {
				/**
				 * Sets up and returns the link that handles the LightBox events
				 **/
				setupLink: function (idx) {
					var link = this.thumbs[idx].parentNode;
					b.on(link, 'click', e.linkClick, this, [idx]);
					return link;
				},
				/**
				 * Should produce the HTML of the enlarged content & append it to the doc
				 **/
				setupContent: function () {
					var wrapper = this.content || doc.createElement('div'),
						content = doc.createElement('div'),
						img = doc.createElement('img'),
						link = this.links[this.selectedIndex],
						thumb = this.thumbs[this.selectedIndex],
						src = link.dataset && link.dataset.big || link.href,
						title = thumb.title || '',
						alt = thumb.alt || '';
					b.extend(wrapper, {
						className: this.conf.wrapperClass,
						innerHTML: '' // clean up the content
					});
					content.className = this.conf.contentClass;
					b.on(img, 'load', e.imageLoad, this);
					b.extend(img, {
						'src': src,
						'title': title,
						'alt': alt
					});
					b.on(wrapper, 'click', e.openWrapperClick, this);
					b.append(content, img);
					b.append(wrapper, content);
					this.content = wrapper;
				},
				/**
				 * Called when you want the lightbox to open
				 **/
				open: function () {
					this.showContent();
					this.state = 1;
				},
				/**
				 * Called when you want the lightbox to close
				 **/
				close: function () {
					this.hideContent();
					this.state = 0;
				},
				/**
				 * Should show the content or set it up if it's not present
				 **/
				showContent: function () {
					if (!this.content) {
						this.setupContent();
					}
					b.append(doc.body, this.content);
				},
				/**
				 * Should hide the elarged content
				 **/
				hideContent: function () {
					b.detach(this.content);
				}
			});
			
			/* OPTIONAL: cleaner */
			LB.clean = function () {
				var i = 0, j = LB.instances.length, o;
				for (; i < j; i++) {
					o = LB.instances[i];
					if (o.state) {
						o.close();
					}
					b.off(o.link, 'click', e.linkClick);
					o.thumbs = null;
					o.links = null;
					o.content = null;
				}
				LB.instances = [];
			};
			/* -- */
			
			LB.extend = function (fn) {
				b.extend(LB.prototype, fn(LB));
			}
			
			return LB;
		}());

		// add keyboard events to close when Esc is pressed
		LightBox.extend(function (LB) {
			var b = LB.helpers,
				e = LB.handlers,
				close = LB.prototype.close,
				open = LB.prototype.open;
			b.extend(e, {
				'openEscape': function (ev) {
					if (ev.keyCode === 27) {
						this.close();
					}
				}
			});
			return {
				"close": function () {
					close.apply(this, arguments);
					b.off(document, 'keyup', e.openEscape);
				},
				"open": function () {
					open.apply(this, arguments)
					b.on(document, 'keyup', e.openEscape, this);
				}
			};
		});

		// display title 
		LightBox.extend(function (LB) {
			var b = LB.helpers,
				setupContent = LB.prototype.setupContent;
			b.extend(LB.defaults, {'aboutClass': 'LBabout'});
			return {
				"setupContent": function () {
					setupContent.apply(this, arguments);
					var co = this.content.getElementsByClassName(this.conf.contentClass)[0],
						ab = document.createElement('div'),
						thumb = this.thumbs[this.selectedIndex],
						hasTitle = thumb.title || thumb.alt;
					if (hasTitle) {
						b.addClass(co, 'withText');
						ab.className = this.conf.aboutClass;
						ab.title = thumb.title + ' ' + thumb.alt;
						ab.innerHTML = '<strong>' + thumb.title + '</strong> ' + thumb.alt;
						co.appendChild(ab);
					}
				}
			};
		});
		
		// display download link 
		LightBox.extend(function (LB) {
			var b = LB.helpers,
				setupContent = LB.prototype.setupContent;
			b.extend(LB.defaults, {'downloadClass': 'LBdownload'});
			return {
				"setupContent": function () {
					setupContent.apply(this, arguments);
					var co = this.content.getElementsByClassName(this.conf.contentClass)[0],
						ab = document.createElement('a'),
						link = this.links[this.selectedIndex],
						href = link.dataset && link.dataset.download || link.href;
					b.addClass(co, 'withText');
					b.addClass(co, 'withDownload');
					b.extend(ab, {
						className: this.conf.downloadClass,
						href: href,
						target: '_blank',
						innerHTML: 'Download'
					})
					co.appendChild(ab);
				}
			};
		});
		
		// keyboard next/previous controls 
		LightBox.extend(function (LB) {
			var b = LB.helpers,
				e = LB.handlers,
				close = LB.prototype.close,
				open = LB.prototype.open;
			b.extend(e, {
				'openNextPrevious': function (ev) {
					var d = ev.keyCode === 39 && 1 || ev.keyCode === 37 && -1 || 0;
					if (d) {
						this.selectedIndex = (this.selectedIndex + d + this.thumbs.length) % this.thumbs.length;
						this.setupContent();
					}
				}
			});
			return {
				"close": function () {
					close.apply(this, arguments);
					if (this.thumbs.length) {
						b.off(document, 'keyup', e.openNextPrevious);
					}
				},
				"open": function () {
					open.apply(this, arguments);
					if (this.thumbs.length) {
						b.on(document, 'keyup', e.openNextPrevious, this);
					}
				}
			};
		});
		
		// display close link up top
		LightBox.extend(function (LB) {
			var b = LB.helpers,
				e = LB.handlers,
				setupContent = LB.prototype.setupContent;
			b.extend(LB.defaults, {'closeClass': 'LBclose'});
			b.extend(e, {
				'closeButton': function (ev) {
					this.close();
				}
			});
			return {
				"setupContent": function () {
					setupContent.apply(this, arguments);
					var co = this.content,
						cl = document.createElement('a');
					b.extend(cl, {
						className: this.conf.closeClass,
						innerHTML: 'Close'
					});
					co.appendChild(cl);
					b.on(cl, 'click', e.closeButton, this);
				}
			}
		});
		
		LightBox(document.querySelectorAll(".lb img"));
		/*var list = document.querySelectorAll(".lb img"),
			i = 0, j = 0;
		for (j = list.length; i < j; i++) {
			LightBox([list[i]]);
		}*/
	</script>
</html>