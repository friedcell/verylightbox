<!doctype html>
<html>
	<head>
		<title>Lightbox</title>
		<style>
			html, body {margin:0;padding:0;border:0;background:#ccf;}
			ul, li {margin:0;padding:0;border:0;display:block;}
			li {padding:5px 0 0 5px;float:left;}
			a img {border:0;}
			
			.LBwrapper {position:fixed;top:0;right:0;bottom:0;left:0;padding:20px;z-index:10000;background:rgba(0,0,0,.75);}
			.LBwrapper .LBcontent {margin:0 auto;text-align:center;}
			.LBwrapper .LBcontent img {border:20px solid #fff;max-width:100%;max-height:100%;
				-webkit-box-sizing:border-box;
				-moz-box-sizing:border-box;
				box-sizing:border-box;
			}
		</style>
	</head>
	<body>
		<ul>
			<li>
				<a class="lb" href="download.jpg" data-big="bigger.jpg">
					<img src="thumb.jpg" title="Oakland?" alt="A photo of Oakland coast before landing at SFO" />
				</a>
			</li>
			<li>
				<a class="lb" href="download.jpg" data-big="bigger.jpg">
					<img src="thumb.jpg" title="Oakland?" alt="A photo of Oakland coast before landing at SFO" />
				</a>
			</li>
			<li>
				<a class="lb" href="download.jpg" data-big="bigger.jpg">
					<img src="thumb.jpg" title="Oakland?" alt="A photo of Oakland coast before landing at SFO" />
				</a>
			</li>
		</ul>
	</body>
	<script>
		var ID = function (root) {
			var idMap = {},
				seed = 0,
				supportsDataset = (function () {
					var el = document.createElement('div');
					return !!el.dataset;
				}()),
				gen = function () {
					return root + "-" + (++seed);
				},
				p = {
					'get': function (el, generate) {
						var r = el.id || supportsDataset && el.dataset && el.dataset.id,
							k;
						if (!r && (!supportsDataset || !el.dataset)) {
							for (k in idMap) {
								if (idMap[k] === el) {
									r = k;
								}
							}
						}
						if (!r && generate) {
							r = gen();
							if (supportsDataset && el.dataset) {
								el.dataset.id = r;
							}
							idMap[r] = el;
						}
						return r;
					},
					'fetch': function (id) {
						return idMap[id];
					},
					'debug': function () {
						return [root, seed, supportsDataset, gen, idMap, p];
					}
				};
			return p;
		};
		var Events = (function () {
			function typesplit(s) {
				var l = s.indexOf('.') > 0 ? s.split('.') : [s, ''];
				return {'type': l.shift(), 'ns': l.join('.')};
			}
			var idGen = ID('events'),
				handlers = {},
				p = {
					'on': function (el, type, handler, scope) {
						type = typesplit(type);
						var id = idGen.get(el, true),
							d = {
								id: idGen.get(el, true),
								el: el,
								type: type.type,
								ns: type.ns,
								handler: handler,
								proxy: function () {
									handler.apply(scope, arguments);
								},
								start: (new Date).getTime()
							};
						if (!handlers[id]) {
							handlers[id] = {};
						}
						if (!handlers[id][type.type]) {
							handlers[id][type.type] = [];
						}
						handlers[id][type.type].push(d);
						if (el.nodeType === 1) {
							el.addEventListener(type.type, d.proxy);
						}
						return p;
					},
					'off': function (el, type, handler) {
						var id = idGen.get(el),
							dtype = typesplit(type),
							h, i, j, n,
							r = [];
						if (!id) {
							return p;
						}
						h = handlers[id][dtype.type] || [];
						for (i = 0, j = h.length; i < j; i++) {
							n = h[i];
							if ((dtype.ns && n.ns === dtype.ns || !dtype.ns) && (handler && n.handler === handler || !handler)) {
								if (el.nodeType === 1) {
									el.removeEventListener(dtype.type, h[i].proxy);
								}
							} else {
								r.push(n);
							}
						}
						if (r.length) {
							handlers[id][dtype.type] = r;
						} else {
							delete handlers[id][dtype.type];
						}
					},
					'trigger': function (el, type, data) {
						if (el.nodeType === 1) {
							if (el.type) {
								el[type]();
							}
						} else {
							var id = idGen.get(el), 
								dtype = typesplit(type),
								h, i, j, n;
							if (!id) {
								return p;
							}
							h = handlers[id][dtype.type] || [];
							for (i = 0, j = h.length; i < j; i++) {
								n = h[i];
								n.proxy(data);
							}
						}
					},
					'gc': function () {
						// remove all nodes with no parent
						// no idea how to make sure we don't lean objects though....	
					},
					'debug': function () {
						return [idGen, handlers, p];
					}
				};
			return p;
		}());
		var LightBox = (function () {
			var LB = function (el, conf) {
					if (this === window) {
						var i = new LB(el, list);
						LB.instances.push(i);
						return i;
					}
					this.el = el;
					this.link = this.setupLink(el);
					this.conf = conf || {};
					this.state = 0;
				},
				b = {
					'show': function (el) {
						el.style.display = 'block';
						return el;
					},
					'hide': function (el) {
						el.style.display = 'none';
						return el;
					},
					'on': function (el, type, handler, scope) {
						el['on' + type] = function () {
							handler.apply(scope || this, arguments);
						}
						return el;
					},
					'off': function (el, type) {
						el['on' + type] = null;
						return el;
					},
					'hasClass': function (el, cls) {
						var c = ' ' + el.className + ' ';
						return c.indexOf(' ' + cls + ' ') >= 0;
					},
					'extend': function (a, b) {
						for (k in b) {
							a[k] = b[k];
						}
						return a;
					}
				};
			LB.instances = [];
			
			//!-- remove in production
			var reqs = ["setupLink", "open", "showContent", "close", "hideContent"],
				f = (function (name) {
					return function () {throw Error("Missing a required function: " + name);};
				}),
				i = 0, j = 0;
			for (i = 0, j = reqs.length; i < j; i++) {
				LB.prototype[reqs[i]] = f(reqs[i]);
			}
			//-- end remove
			
			/**
			 * Sets up and returns the link that handles the LightBox events
			 **/
			LB.prototype.setupLink = function (el) {
				var _this = this;
					link = el.parentNode;
				b.on(link, 'click', function (ev) {
					ev.preventDefault();
					this.open();
				}, this);
				return link;
			};
			/**
			 * Called when you want the lightbox to open
			 **/
			LB.prototype.open = function () {
				this.showContent();
				b.on(document, 'keyup', function (ev) {
					if (ev.keyCode === 27) {
						this.close();
					}
				}, this);
				this.state = true;
			};
			/**
			 * Called when you want the lightbox to close
			 **/
			LB.prototype.close = function () {
				this.hideContent();
				b.off(document, 'keyup');
				this.state = false;
			}
			/**
			 * Should produce the HTML of the enlarged content & show it
			 **/
			LB.prototype.showContent = function () {
				if (this.content) {
					b.show(this.content);
				} else {
					var el = document.body.appendChild(document.createElement('div'));
					el.className = 'LBwrapper';
					el.innerHTML = '<div class="LBcontent"><img src="' + (this.link.dataset.big || this.link.href) + '" title="' + (this.el.title || '') + '" alt="' + (this.el.alt || '') + '" /></div>';
					b.on(el, 'click', function (ev) {
						var el = ev.srcElement;
						if (b.hasClass(el, 'LBwrapper') || b.hasClass(el, 'LBcontent')) {
							this.close();
						}
					}, this);
					this.content = el;
				}
			};
			/**
			 * Should hide the elarged content
			 **/
			LB.prototype.hideContent = function () {
				b.hide(this.content);
			};
			
			/* OPTIONAL: cleaner */
			LB.clean = function () {
				var i = 0, j = LB.instances.length, o;
				for (; i < j; i++) {
					o = LB.instances[i];
					if (o.state) {
						o.close();
					}
					b.off(o.el, 'click');
					b.off(o.link, 'click');
					o.el = null;
					o.link = null;
				}
				LB.instances = [];
			}
			/* -- */
			
			return LB;
		}());
		var list = document.querySelectorAll(".lb img"),
			i = 0, j = 0;
		for (j = list.length; i < j; i++) {
			LightBox(list[i], {list: list});
		}
	</script>
</html>