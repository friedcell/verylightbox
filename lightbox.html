<!doctype html>
<html>
	<head>
		<title>Lightbox</title>
		<style>
			html, body {margin:0;padding:0;border:0;background:#ffc;font-family:sans-serif;}
			ul, li {margin:0;padding:0;border:0;display:block;overflow:hidden;}
			li {padding:5px 0 0 5px;float:left;}
			a img {border:0;}
			ul li a img {height:150px;}
			
			.LBwrapper {position:fixed;top:0;right:0;bottom:0;left:0;padding:20px;z-index:10000;background:rgba(0,0,0,.75);text-align:center;line-height:0;}
			.LBwrapper .LBcontent {display:inline;position:relative;}
			.LBwrapper .LBcontent img {display:inline;border:10px solid #fff;max-width:100%;max-height:100%;vertical-align:-.25em;
				-webkit-box-sizing:border-box;-webkit-border-radius:2px;
				-moz-box-sizing:border-box;-moz-border-radius:2px;
				box-sizing:border-box;border-radius:2px;
			}
			
			.LBwrapper .LBcontent.withText img {border-bottom-width:40px;}
			.LBwrapper .LBcontent .LBabout {position:absolute;bottom:0;left:0;right:0;padding:10px 0;margin:0 10px;line-height:20px;text-align:left;height:20px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;}
			
			.LBwrapper .LBcontent.withDownload .LBabout {padding-right:5em;}
			.LBwrapper .LBcontent .LBdownload {position:absolute;bottom:10px;right:10px;padding:.25em .5em;text-transform:uppercase;color:#222;font-size:.625em;line-height:1.5;background:#ccc;color:#222;text-decoration:none;font-weight:bold;cursor:pointer;
				-webkit-border-radius:2px;-webkit-box-shadow:0 0 1px #000;
				-moz-border-radius:2px;-moz-box-shadow:0 0 1px #000;
				border-radius:2px;box-shadow:0 0 1px #000;
			}
			.LBwrapper .LBcontent.withShortDownload .LBabout {padding-right:2em;}
			
			.LBwrapper .LBclose {position:absolute;right:5px;top:5px;display:block;padding:.25em .5em;background:#fff;color:#222;text-decoration:none;text-transform:uppercase;font-weight:bold;font-size:.625em;line-height:1.5;cursor:pointer;
				-webkit-border-radius:2px;
				-moz-border-radius:2px;
				border-radius:2px;
			}
		</style>
	</head>
	<body>
		<ul class="list1">
			<li>
				<a class="lb" href="download1.jpg" data-big="bigger1.jpg">
					<img src="thumb1.jpg" title="Candice Swanepoel" alt="Top 99 Women" />
				</a>
			</li>
			<li>
				<a class="lb" href="download2.jpg" data-big="bigger2.jpg">
					<img src="thumb2.jpg" title="Candice Swanepoel" alt="Design your Trust" />
				</a>
			</li>
			<li>
				<a class="lb" href="download3.jpg" data-big="bigger3.jpg">
					<img src="thumb3.jpg" title="Candice Swanepoel" alt="38 Breath Taking Victoria's Secret Swim Photos" />
				</a>
			</li>
		</ul>
		<ul class="list2">
			<li>
				<a class="lb" href="download.jpg" data-big="bigger.jpg">
					<img src="thumb.jpg" title="Oakland?" alt="Landing at SFO" />
				</a>
			</li>
		</ul>
	</body>
	<script>
		/**
		 * ID provides an object that gives out unique ids to DOM elements and indexes them
		 **/
		/*var ID = function (root) {
			var idMap = {},
				seed = 0,
				supportsDataset = (function () {
					var el = document.createElement('div');
					return !!el.dataset;
				}()),
				gen = function () {
					return root + "-" + (++seed);
				},
				getData = function (el, prop, def) {
					return supportsDataset && el.dataset && el.dataset[prop] || def;
				},
				p = {
					'get': function (el, generate) {
						var r = el.id || getData(el, 'id'),
							k;
						// if element doesn't have an id attached, try to find it in the index
						if (!r && (!supportsDataset || !el.dataset)) {
							for (k in idMap) {
								if (idMap[k] === el) {
									r = k;
								}
							}
						}
						if (!r && generate) {
							r = gen();
							if (supportsDataset && el.dataset) {
								el.dataset.id = r;
							}
							idMap[r] = el;
						}
						return r;
					},
					'fetch': function (id) {
						return idMap[id];
					},
					'debug': function () {
						return [root, seed, supportsDataset, gen, idMap, p];
					}
				};
			return p;
		};*/
		/**
		 * Events provides an object that handles events
		 **/
		/*var Events = (function () {
			function typesplit(s) {
				var l = s.indexOf('.') > 0 ? s.split('.') : [s, ''];
				return {'type': l.shift(), 'ns': l.join('.')};
			}
			var idGen = ID('events'),
				handlers = {},
				p = {
					'on': function (el, type, handler, scope) {
						type = typesplit(type);
						var id = idGen.get(el, true),
							d = {
								id: idGen.get(el, true),
								el: el,
								type: type.type,
								ns: type.ns,
								handler: handler,
								proxy: function () {
									handler.apply(scope, arguments);
								},
								start: (new Date).getTime()
							};
						if (!handlers[id]) {
							handlers[id] = {};
						}
						if (!handlers[id][type.type]) {
							handlers[id][type.type] = [];
						}
						handlers[id][type.type].push(d);
						if (el.nodeType === 1) {
							el.addEventListener(type.type, d.proxy);
						}
						return p;
					},
					'off': function (el, type, handler) {
						var id = idGen.get(el),
							dtype = typesplit(type),
							h, i, j, n,
							r = [];
						if (!id) {
							return p;
						}
						h = handlers[id][dtype.type] || [];
						for (i = 0, j = h.length; i < j; i++) {
							n = h[i];
							if ((dtype.ns && n.ns === dtype.ns || !dtype.ns) && (handler && n.handler === handler || !handler)) {
								if (el.nodeType === 1) {
									el.removeEventListener(dtype.type, h[i].proxy);
								}
							} else {
								r.push(n);
							}
						}
						if (r.length) {
							handlers[id][dtype.type] = r;
						} else {
							delete handlers[id][dtype.type];
						}
					},
					'trigger': function (el, type, data) {
						if (el.nodeType === 1 && el.type) {
							el[type]();
							// how do you trigger custom event types? surely not manually?!
						} else {
							var id = idGen.get(el), 
								dtype = typesplit(type),
								h, i, j, n;
							if (!id) {
								return p;
							}
							h = handlers[id][dtype.type] || [];
							for (i = 0, j = h.length; i < j; i++) {
								n = h[i];
								n.proxy(data);
							}
						}
					},
					'gc': function () {
						// remove all nodes with no parent
						// no idea how to make sure we don't lean objects though....	
					},
					'debug': function () {
						return [idGen, handlers, p];
					}
				};
			return p;
		}());*/
		/**
		 * Simple events
		 **/
		var CustEv = (function () {
			function createEvent(type) {
				return (r = {
					'type': type,
					'stopPropagation': function () {
						r.stop = true;
					},
					'stop': false
				});
			}
			return function (scope) {
				var store = {};
				return {
					'on': function (type, handler, data) {
						if (!store[type]) store[type] = [[handler, data]];
						else store[type].push([handler, data]);
					},
					'off': function (type, handler) {
						if (!handler) {
							return !!(store[type] = []);
						}
						var handlers = store[type],
							i = handlers && handlers.length || -1;
						for (; i >= 0; i -= 1) {
							if (handlers[i][0] === handler) {
								handlers.splice(i, 1);
								return true;
							}
						}
						return false;
					},
					'fire': function (type, data) {
						var i = 0,
							l = store[type] && store[type].length || 0,
							ev = createEvent(type),
							fireScope = scope || this,
							item, retVal;
						for (; i < l; i += 1) {
							item = store[type][i];
							try {
								ev.data = item[1];
								retVal = item[0].apply(fireScope, [ev].concat(data || []));
							} catch (e) {console.log(e);}
							if (ev.stop || retVal === false) {
								break;
							}
						}
					}
				};
			}
		}());
		/**
		 * LightBox object
		 **/
		var LightBox = (function () {
			var doc = document,
				LB = function (thumbs, conf) {
					var i;
					if (this === window) {
						i = new LB(thumbs, conf);
						LB.instances.push(i);
						return i;
					}
					b.extend(this, {
						'conf': b.inject(LB.conf, conf),
						'thumbs': thumbs,
						'links': [],
						'selectedIndex': -1,
						'content': null,
						'state': 0,
						'extend': function (fn) {
							b.extend(this, fn(this, b));
						}
					});
					b.extend(this, CustEv(this));
					for (i = this.thumbs.length - 1; i >= 0; i -= 1) {
						this.links[i] = this.setupLink(i);
					}
				},
				b = {
					'append': function (wr, el) {
						wr.appendChild(el);
						return wr;
					},
					'detach': function (el) {
						el.parentNode && el.parentNode.removeChild(el);
						return el;
					},
					'on': function (el, type, handler, scope, addArgs) {
						handler.__handler__ = function () {
							var args = Array.prototype.slice.call(arguments);
							args = args.concat(addArgs || []);
							handler.apply(scope || this, args);
						};
						el.addEventListener(type, handler.__handler__, false);
						return el;
					},
					'off': function (el, type, handler) {
						el.removeEventListener(type, handler.__handler__)
						return el;
					},
					'hasClass': function (el, cls) {
						var c = ' ' + el.className + ' ';
						return c.indexOf(' ' + cls + ' ') >= 0;
					},
					'addClass': function (el, cls) {
						var c
						if (!b.hasClass(el, cls)) {
							c = el.className + ' ' + cls;
							while (c.indexOf('  ') >= 0) {
								c = c.replace(/  /g, ' ');
							}
							el.className = c;
						}
					},
					'extend': function (destObj, sourceObj) {
						for (key in sourceObj) {
							destObj[key] = sourceObj[key];
						}
						return destObj;
					},
					'repaint': function (el) {
						var d = el.style.display;
						el.style.display = 'none';
						el.parentNode.offsetWidth;
						el.style.display = d;
					},
					'inject': function (defaults, obj) {
						return b.extend(b.extend({}, defaults), obj);
					}
				},
				e = {
					'linkClick': function (ev, idx) {
						ev.preventDefault();
						if (idx !== this.selectedIndex) {
							this.selectedIndex = idx;
							this.setupContent();
						}
						this.open();
					},
					'wrapperClick': function (ev) {
						var target = ev.target;
						if (b.hasClass(target, this.conf.wrapperCls)) {
							this.close();
						}
					},
					'imageLoad': function (ev) {
						var img = this.content.getElementsByClassName(this.conf.objectCls)[0];
						b.repaint(this.content);
					}
				}
			b.extend(LB, {
				"instances": [],
				"conf": {
					wrapperCls: 'LBwrapper',
					contentCls: 'LBcontent',
					objectCls: 'LBobject'
				},
				"handlers": e,
				"helpers": b
			});
			b.extend(LB, CustEv());
			
			b.extend(LB.prototype, {
				/**
				 * Sets up and returns the link that handles the LightBox events
				 **/
				setupLink: function (idx) {
					var link = this.thumbs[idx].parentNode;
					b.on(link, 'click', e.linkClick, this, [idx]);
					return link;
				},
				/**
				 * Should produce the HTML of the enlarged content & append it to the doc
				 **/
				setupContent: function () {
					var i = this.selectedIndex,
						// elements
						wrapper = this.content || doc.createElement('div'),
						content = doc.createElement('div'),
						img = doc.createElement('img'),
						// data
						link = this.links[i],
						thumb = this.thumbs[i],
						src = link.dataset && link.dataset.big || link.href,
						title = thumb.title || '',
						alt = thumb.alt || '';
					b.extend(wrapper, {
						className: this.conf.wrapperCls,
						innerHTML: '' // clean up the content
					});
					b.on(wrapper, 'click', e.wrapperClick, this);
					content.className = this.conf.contentCls;
					b.on(img, 'load', e.imageLoad, this);
					b.extend(img, {
						'className': this.conf.objectCls,
						'src': src,
						'title': title,
						'alt': alt
					});
					b.append(content, img);
					this.content = b.append(wrapper, content);
					LB.fire.call(this, 'afterSetupContent');
					this.fire('afterSetupContent');
				},
				/**
				 * Called when you want the lightbox to open
				 **/
				open: function () {
					this.showContent();
					this.state = 1;
					LB.fire.call(this, 'afterOpen');
					this.fire('afterOpen');
				},
				/**
				 * Called when you want the lightbox to close
				 **/
				close: function () {
					this.hideContent();
					this.state = 0;
					LB.fire.call(this, 'afterClose');
					this.fire('afterClose');
				},
				/**
				 * Should show the content or set it up if it's not present
				 **/
				showContent: function () {
					if (!this.content) {
						this.setupContent();
					}
					b.append(doc.body, this.content);
				},
				/**
				 * Should hide the elarged content
				 **/
				hideContent: function () {
					b.detach(this.content);
				}
			});
			
			LB.extend = function (fn) {
				b.extend(LB.prototype, fn(LB, LB.helpers) || {});
			}
			
			return LB;
		}());

		// add cleaner
		function LBCleanerPlugin(obj, helpers) {
			if (!obj.prototype) { // only apply to constructor, not instance
				return;
			}
			obj.clean = function () {
				var i = 0, j = obj.instances.length, o;
				for (; i < j; i++) {
					o = obj.instances[i];
					if (o.state) {
						o.close();
					}
					b.off(o.link, 'click', e.linkClick);
					o.thumbs = null;
					o.links = null;
					o.content = null;
				}
				obj.instances = [];
			};
		}
		
		// add keyboard events to close when Esc is pressed
		function LBEscapeClosePlugin(obj, helpers) {
			var doc = document;
			function escape(ev) {
				if (ev.keyCode === 27) {
					this.close();
				}
			}
			obj.on('afterClose', function (ev) {
				helpers.off(doc, 'keyup', escape);
			});
			obj.on('afterOpen', function (ev) {
				helpers.on(doc, 'keyup', escape, this);
			});
		}

		// display title 
		function LBDisplayTitlePlugin(obj, helpers) {
			obj.conf = helpers.inject({
				'aboutCls': 'LBabout',
				'textModCls': 'withText',
				'displayTitle': function (elm) {
					return (elm.title || elm.alt) ? elm.title + ' ' + elm.alt : '';
				},
				'displayHTML': function (elm) {
					return (elm.title || elm.alt) ? '<strong>' + elm.title + '</strong> ' + elm.alt : '';
				}
			}, obj.conf);
			obj.on('afterSetupContent', function (ev) {
				var inst = this,
					conf = inst.conf,
					contentElm = inst.content.getElementsByClassName(conf.contentCls)[0],
					aboutElm = document.createElement('div'),
					thumb = inst.thumbs[inst.selectedIndex]
					hasTitle = thumb.title || thumb.alt;
				if (hasTitle) {
					helpers.addClass(contentElm, conf.textModCls);
					helpers.extend(aboutElm, {
						'className': conf.aboutCls,
						'title': conf.displayTitle(thumb),
						'innerHTML': conf.displayHTML(thumb)
					});
					contentElm.appendChild(aboutElm);
				}
			});
		}
		
		// display download link 
		function LBDownloadPlugin(obj, helpers) {
			obj.conf = helpers.inject({
				'downloadCls': 'LBdownload',
				'downloadHTML': 'Download',
				'textModifierCls': 'withText',
				'downloadModCls': 'withDownload'
			}, obj.conf);
			obj.on('afterSetupContent', function (ev) {
				var inst = this,
					conf = inst.conf,
					contentElm = inst.content.getElementsByClassName(conf.contentCls)[0],
					downloadElm = document.createElement('a'),
					link = inst.links[inst.selectedIndex],
					dataset = link.dataset,
					href = dataset && dataset.download || link.href;
				helpers.addClass(contentElm, conf.textModifierCls);
				helpers.addClass(contentElm, conf.downloadModCls);
				helpers.extend(downloadElm, {
					className: conf.downloadCls,
					href: href,
					target: '_blank',
					innerHTML: conf.downloadHTML
				})
				contentElm.appendChild(downloadElm);
			});
		}
		
		// keyboard next/previous controls 
		function LBKeyboardNav(obj, helpers) {
			var doc = document;
			function nextPrevious(ev) {
				var indexDiff = ev.keyCode === 39 && 1 || ev.keyCode === 37 && -1 || 0,
					len;
				if (indexDiff) {
					len = this.thumbs.length;
					this.selectedIndex = (this.selectedIndex + indexDiff + len) % len;
					this.setupContent();
				}
			}
			obj.on('afterClose', function (ev) {
				if (this.thumbs.length) {
					helpers.off(doc, 'keyup', nextPrevious);
				}
			});
			obj.on('afterOpen', function (ev) {
				if (this.thumbs.length) {
					helpers.on(doc, 'keyup', nextPrevious, this);
				}
			});
		}
		
		// display close link up top
		function LBCloseButton(obj, helpers) {
			obj.conf = helpers.inject({
				'closeCls': 'LBclose',
				'closeHTML': 'Close'
			}, obj.conf);
			function close (ev) {
				this.close();
			}
			obj.on('afterSetupContent', function (ev) {
				var inst = this,
					conf = inst.conf,
					wrapperElm = inst.content,
					closeElm = document.createElement('a');
				helpers.extend(closeElm, {
					className: conf.closeCls,
					innerHTML: conf.closeHTML
				});
				wrapperElm.appendChild(closeElm);
				helpers.on(closeElm, 'click', close, inst);
			});
		}

		LightBox.extend(LBCleanerPlugin);
		LightBox.extend(LBDownloadPlugin);
		LightBox.extend(LBEscapeClosePlugin);
		
		lb1 = LightBox(document.querySelectorAll(".list1 .lb img"), {
			'downloadModCls': 'withShortDownload',
			'downloadHTML': '&#8595;'
		});
		lb1.extend(LBDisplayTitlePlugin);
		lb1.extend(LBKeyboardNav);
		lb1.extend(LBCloseButton);
		
		lb2 = LightBox(document.querySelectorAll(".list2 .lb img"));
	</script>
</html>